<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Police Dashboard</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M" crossorigin="anonymous">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    <link rel="stylesheet" type="text/css" href="css/structure.css">
    <link rel="icon" href="data:;base64,iVBORw0KGgo=">

  </head>
  <body>
    <div class="row margin-top-4">
      <div class="col-md-12 text-align-center font-size-20-px margin-left-2">
        San Andreas <img class="image-star" src="/images/star.png" alt="star"> Police Operations
      </div>

    </div>

    <div class="row">
      <div class="col-md-12 text-align-center font-size-20-px">
        Hi, <%= user.user.username %>
      </div>
    </div>

    <div class="row margin-top-2">
      <div class="col-md-12 text-align-center">
        <button type="button" class="btn btn-primary btn-width-150" data-toggle="modal" data-target=".run-name">Name Database</button>
        <button type="button" class="btn btn-primary btn-width-150" data-toggle="modal" data-target=".run-plate">Plate Database</button>
        <button type="button" class="btn btn-primary btn-width-150" data-toggle="modal" data-target=".ticket" onclick="setDateAndTime();">Issue Ticket</button>
        <button type="button" class="btn btn-default btn-width-150" onClick="parent.location='/logout'">Log Out</button>
      </div>
    </div>

    <!-- Run Civilian Modal  -->
    <div class="modal fade run-name" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg">

        <div id="warrantMessage" class="alert alert-danger" style="display:none">
          <strong>Danger!</strong> Warrant found for this suspect.
        </div>
        <div id="noWarrantFound" class="alert alert-success" style="display:none">
          <strong>Clean!</strong> No Warrants found.
        </div>
        <div class="modal-content">
          <form id="search-form" class="form-horizontal" action="" method="">
            <fieldset>

              <!-- Form Name -->
              <legend class="text-align-center">Person Database</legend>
              <datalist id="names">
                <% for(var i=0; i<civilians.length; i++) {%>
             <option value="<%= civilians[i].civilian.firstName %> <%= civilians[i].civilian.lastName%>">
            <% } %>
              </datalist>
              <!-- Text input-->
              <div class="form-group">
                <label class="col-md-4 control-label" for="civName">Civilian Name</label>
                <div class="col-md-4">
                  <input id="civName" name="civName" type="text" placeholder="Civilian Name" class="form-control input-md" list="names" required>
                </div>
                <div class="col-md-4">
                  <button type="button" name="searchCiv" class="btn btn-info" onclick="searchNames()" >Search</button>
                </div>
              </div>


               <div id="civDetails" class="civ-details" style="display:none">
                <div id="first-and-last-name" class="col-md-12 name">
                  FirstName LastName
                </div>
                <div class="col-md-12">
                  <div class="col-md-1 font-size-16-px">
                    DOB:
                  </div>
                  <div id="birthday" class="col-md-1 birthday font-size-16-px">
                    mm/dd/yyyy
                  </div>
                </div>
                <div id="address" class="col-md-12 address font-size-16-px">
                  Address: - - -
                </div>
                <div class="col-md-12 ncic-button">
                  <button id="warrants" type="button" class="btn btn-primary btn-width-150" onclick="checkWarrantStatus()">NCIC Warrant Check</button>
                </div>
                <div class="col-md-12">
                  <div class="col-md-2 col-md-offset-4 font-size-16-px">
                    License:
                  </div>
                   <div id="license-status" class="col-md-1 font-size-16-px license-status">
                      license status
                  </div>
                </div>


                <div class="col-md-12">
                  <div  class="col-md-3 col-md-offset-4 font-size-16-px">
                    Ticket Count:
                  </div>
                   <div id="ticket-count" class="col-md-1 font-size-16-px ticket-count">
                     # tickets
                   </div>
                </div>

                <!--Table for Tickets  -->
                <div class="col-md-5 col-md-offset-1 name-table">
                  <table id="ticket-table" class="table table-hover" border="1" frame="box">
                    <thead>
                      <tr>
                        Tickets:
                      </tr>
                    </thead>
                      <tbody id="ticket-body">
                      </tbody>
                  </table>
                </div>
               </div>
            </fieldset>
          </form>
        </div>
      </div>
    </div>

    <div class="modal fade run-plate" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div id="stolenMessage" class="alert alert-danger" style="display:none">
          <strong>Danger!</strong> Vehicle reported as stolen.
        </div>
        <div class="modal-content">
          <form id="plate-form" class="form-horizontal" action="" method="">
            <fieldset>

              <!-- Form Name -->
              <legend class="text-align-center">Vehicle Database</legend>
              <datalist id="plates">
                <% for(var i=0; i<vehicles.length; i++) {%>
             <option value="<%= vehicles[i].vehicle.plate %>">
            <% } %>
              </datalist>
              <!-- Text input-->
              <div class="form-group">
                <label class="col-md-4 control-label" for="plateName">Plate Number</label>
                <div class="col-md-4">
                  <input id="plateName" name="plateName" type="text" placeholder="License Plate #" class="form-control input-md" list="plates" required>
                </div>
                <div class="col-md-4">
                  <button type="button" name="searchPlateNum" class="btn btn-info" onclick="searchPlate()">Search</button>
                </div>
              </div>


               <div id="plateDetails" class="civ-details" style="display:none">
                <div id="plate" class="col-md-12 name">
                  License Plate #
                </div>
                <div class="col-md-12">
                  <div class="col-md-1 font-size-16-px">
                    Color:
                  </div>
                  <div id="color" class="col-md-4 font-size-16-px">
                    color
                  </div>
                </div>
                <div class="col-md-12">
                  <div class="col-md-1 font-size-16-px">
                    Model:
                  </div>
                  <div id="model" class="col-md-4 margin-bottom-2 font-size-16-px">
                    car model
                  </div>
                </div>
                <div class="col-md-12">

                </div>
                <div class="col-md-12">
                  <div class="col-md-1 font-size-16-px">
                    RO:
                  </div>
                  <div id="reg-owner" class="col-md-4 ro-name font-size-16-px">
                    firstname lastname
                  </div>
                </div>
                <div class="col-md-12">
                  <div class="col-md-3 font-size-16-px margin-bottom-2">
                    Owner's License:
                  </div>
                  <div id="license" class="col-md-3 owners-license font-size-16-px">
                    N/A
                  </div>
                </div>
                <div class="col-md-12">

                </div>
                <div class="col-md-12">
                  <div class="col-md-2 font-size-16-px">
                    Insurance:
                  </div>
                  <div id="insurance" class="col-md-2 font-size-16-px">
                    --
                  </div>
                </div>

                <div class="col-md-12">
                  <div class="col-md-2 font-size-16-px reg-padding-bottom">
                    Registration:
                  </div>
                  <div id="registration" class="col-md-2 font-size-16-px">
                    --
                  </div>
                </div>
               </div>
            </fieldset>
          </form>
        </div>
      </div>
    </div>

    <!-- Ticket  -->
    <div class="modal fade ticket" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <form class="form-horizontal" action="/create-ticket" method="POST">
          <fieldset>

          <!-- Form Name -->
          <legend>San Andreas Traffic Ticket</legend>

          <!-- Text input-->
          <div class="form-group">
          <label class="col-md-4 control-label" for="date">Date of Violation</label>
          <div class="col-md-4">
          <input id="date" name="date" type="text" placeholder="mm/dd/yyyy" class="form-control input-md" required="">

          </div>
          </div>

          <!-- Text input-->
          <div class="form-group">
          <label class="col-md-4 control-label" for="time">Time</label>
          <div class="col-md-4">
          <input id="time" name="time" type="text" placeholder="hh:mm" class="form-control input-md" required="">

          </div>
          </div>

          <!-- Text input-->
          <div class="form-group">
          <label class="col-md-4 control-label" for="civName">Name</label>
          <div class="col-md-4">
          <input id="civName" name="civName" type="text" placeholder="name" class="form-control input-md" list="names">

          </div>
          </div>

          <!-- Text input-->
          <div class="form-group">
          <label class="col-md-4 control-label" for="plate">Plate</label>
          <div class="col-md-4">
          <input id="plate" name="plate" type="text" placeholder="plate" class="form-control input-md" list="plates">

          </div>
          </div>

          <datalist id="models">
            <% for(var i=0; i<vehicles.length; i++) {%>
         <option value="<%= vehicles[i].vehicle.model %>">
        <% } %>
          </datalist>

          <!-- Text input-->
          <div class="form-group">
          <label class="col-md-4 control-label" for="model">Model</label>
          <div class="col-md-4">
          <input id="model" name="model" type="text" placeholder="model" class="form-control input-md" list="models">

          </div>
          </div>

          <datalist id="colors">
            <% for(var i=0; i<vehicles.length; i++) {%>
         <option value="<%= vehicles[i].vehicle.color %>">
        <% } %>
          </datalist>

          <!-- Text input-->
          <div class="form-group">
          <label class="col-md-4 control-label" for="color">Color</label>
          <div class="col-md-4">
          <input id="color" name="color" type="text" placeholder="color" class="form-control input-md" list="colors">

          </div>
          </div>

          <!-- Text input-->
          <div class="form-group">
          <label class="col-md-4 control-label" for="registeredOwner">Registered Owner</label>
          <div class="col-md-4">
          <input id="registeredOwner" name="registeredOwner" type="text" placeholder="registered owner" class="form-control input-md" list="names">

          </div>
          </div>

          <!-- Multiple Checkboxes (inline) -->
          <div class="form-group">
          <label class="col-md-4 control-label" for="violations">Violations</label>
          <div class="col-md-4">
          <label class="checkbox-inline" for="violations-0">
          <input type="checkbox" name="violations" id="violations-0" value="Speed" onclick="toggle_visibility(speedViolationGroup);">
          Speed
          </label>
          <label class="checkbox-inline" for="violations-1">
          <input type="checkbox" name="violations" id="violations-1" value="DUI" onclick="toggle_visibility(duiViolationGroup);">
          DUI
          </label>
          <label class="checkbox-inline" for="violations-2">
          <input type="checkbox" name="violations" id="violations-2" value="Driver license" onclick="toggle_visibility(driverLicenseViolationGroup);">
          Driver License
          </label>
          <label class="checkbox-inline" for="violations-3">
          <input type="checkbox" name="violations" id="violations-3" value="Invalid registration">
          No Valid Registration
          </label>
          <label class="checkbox-inline" for="violations-4">
          <input type="checkbox" name="violations" id="violations-4" value="Invalid insurance">
          No Proof Insurance
          </label>
          <label class="checkbox-inline" for="violations-5">
          <input type="checkbox" name="violations" id="violations-5" value="Violated traffic signal">
          Violated Traffic Signal
          </label>
          <label class="checkbox-inline" for="violations-6">
          <input type="checkbox" name="violations" id="violations-6" value="Failure to yield">
          Failure to Yield
          </label>
          <label class="checkbox-inline" for="violations-7">
          <input type="checkbox" name="violations" id="violations-7" value="Other" onclick="toggle_visibility(otherOffenseGroup);">
          Other
          </label>
          </div>
          </div>

          <!-- Speed Violation -->
          <div id="speedViolationGroup" class="form-group" style="display:none">
            <label class="col-md-4 control-label" for="speedViolation">Speed Violation</label>
            <div class="col-md-4">
            <div class="checkbox">
              <label for="speedViolation-0">
                <input type="checkbox" name="speedViolation" id="speedViolation-0" value="Over limit">
                Over limit
              </label>
          	</div>
            <div class="checkbox">
              <label for="speedViolation-1">
                <input type="checkbox" name="speedViolation" id="speedViolation-1" value="Unsafe for conditions">
                Unsafe for conditions
              </label>
          	</div>
            </div>
          </div>

          <!-- DUI Violation -->
          <div id="duiViolationGroup" class="form-group" style="display:none">
            <label class="col-md-4 control-label" for="duiViolation">DUI Violation</label>
            <div class="col-md-4">
            <div class="checkbox">
              <label for="duiViolation-0">
                <input type="checkbox" name="duiViolation" id="duiViolation-0" value="Under the influence">
                Under the influence
              </label>
          	</div>
            <div class="checkbox">
              <label for="duiViolation-1">
                <input type="checkbox" name="duiViolation" id="duiViolation-1" value="Prohibited B.A.C">
                Prohibited B.A.C
              </label>
          	</div>
            </div>
          </div>

          <!-- Driver License Violation -->
          <div id="driverLicenseViolationGroup" class="form-group" style="display:none">
            <label class="col-md-4 control-label" for="driverLicenseViolation">Driver License Violation</label>
            <div class="col-md-4">
            <div class="checkbox">
              <label for="driverLicenseViolation-0">
                <input type="checkbox" name="driverLicenseViolation" id="driverLicenseViolation-0" value="No license">
                None
              </label>
          	</div>
            <div class="checkbox">
              <label for="driverLicenseViolation-1">
                <input type="checkbox" name="driverLicenseViolation" id="driverLicenseViolation-1" value="Not on person">
                Not on person
              </label>
          	</div>
            <div class="checkbox">
              <label for="driverLicenseViolation-2">
                <input type="checkbox" name="driverLicenseViolation" id="driverLicenseViolation-2" value="Revoked">
                Revoked
              </label>
          	</div>
            </div>
          </div>

          <!-- Other Offense-->
          <div id="otherOffenseGroup" class="form-group" style="display:none">
          <label class="col-md-4 control-label" for="otherInput">Other Offense</label>
          <div class="col-md-4">
          <input id="otherInput" name="otherInput" type="text" placeholder="offense" class="form-control input-md">

          </div>
          </div>

          <!-- Text input-->
          <div class="form-group">
          <label class="col-md-4 control-label" for="amount">Fine Amount</label>
          <div class="col-md-4">
          <input id="amount" name="amount" type="text" placeholder="$ amount" class="form-control input-md" required="">

          </div>
          </div>

          <!-- Button -->
          <div class="form-group">
          <label class="col-md-4 control-label" for="submitTicket"></label>
          <div class="col-md-4">
          <button id="submitTicket" name="officerEmail" class="btn btn-primary" value=<%= user.user.email%>>Submit</button>
          </div>
          </div>

          </fieldset>
          </form>

        </div>
      </div>
    </div>

  </body>
</html>

<script type="text/javascript">

function searchPlate() {
  var stolenVehicle = document.getElementById('stolenMessage');
  stolenVehicle.style.display = 'none';
  var x = document.getElementById('plateDetails');
  if (x.style.display === 'none') {
      x.style.display = 'block';
  } else {
  }

  var myValue = $('#plateName').val();
  var myVar = <%- JSON.stringify(vehicles) %>;
  var index = 0;
  for (i=0; i < myVar.length; i++) {
    if (myVar[i].vehicle.plate === myValue) {
      index = i;
      break;
    }
  }
  var color = myVar[index].vehicle.color
  var plate = myVar[index].vehicle.plate
  var model = myVar[index].vehicle.model
  var registeredOwner = myVar[index].vehicle.registeredOwner
  var validInsurance = myVar[index].vehicle.validInsurance
  if (validInsurance === "1") {
    validInsurance = "Valid"
  } else {
    validInsurance = "Not Valid"
  }
  var validRegistration = myVar[index].vehicle.validRegistration
  if (validRegistration === "1") {
    validRegistration = "Valid"
  } else {
    validRegistration = "Not Valid"
  }
  var isStolen = myVar[index].vehicle.isStolen
  if (isStolen === "2") {
    stolenVehicle.style.display = 'block';
  }

  $('#color').text(color)
  $('#plate').text(plate)
  $('#model').text(model)
  $('#reg-owner').text(registeredOwner)
  $('#insurance').text(validInsurance)
  $('#registration').text(validRegistration)

}

  function searchNames(){
    var cleanWarrant = document.getElementById('noWarrantFound');
    var dirtyWarrant = document.getElementById('warrantMessage');
    cleanWarrant.style.display = 'none';
    dirtyWarrant.style.display = 'none';
    var x = document.getElementById('civDetails');
    if (x.style.display === 'none') {
        x.style.display = 'block';
    } else {
    }
    var myValue = $('#civName').val();
    var civName = myValue.split(' ')
    var myCiv = <%- JSON.stringify(civilians) %>;
    var myTicket = <%- JSON.stringify(tickets) %>;
    var index = 0;
    for (i=0; i < myCiv.length; i++) {
      if ((myCiv[i].civilian.firstName === civName[0]) && (myCiv[i].civilian.lastName === civName[1])) {
        index = i;
        break;
      }
    }
    ticketIndex = new Array();

    $("#ticket-table tr").remove(); 
    var table = document.getElementById("ticket-table");

    console.log(ticketIndex);
    for (i=0; i < myTicket.length; i++) {
      if (myTicket[i].ticket.civName === myValue) {
        ticketIndex.push(i);

        var row = table.insertRow(0);
        var cell1 = row.insertCell(0);
        cell1.innerHTML = myTicket[i].ticket.violation;
      }
    }

    var name = myCiv[index].civilian.firstName + ' ' + myCiv[index].civilian.lastName
    var birthday = myCiv[index].civilian.birthday
    var address = myCiv[index].civilian.address
    var licenseStatus = myCiv[index].civilian.licenseStatus
    switch(licenseStatus) {
      case "1":
        licenseStatus = "Valid"
        break
      case "2":
        licenseStatus = "Revoked"
        break
      default:
        licenseStatus = "None"
    }

    var warrants = myCiv[index].civilian.warrants
    if (warrants === "1") {
      warrants = "No"
    } else {
      warrants = "Yes"
    }

    var ticketCount = ticketIndex.length
    $('#first-and-last-name').text(name)
    $('#birthday').text(birthday)
    $('#address').text(address)
    $('#license-status').text(licenseStatus)
    $('#ticket-count').text(ticketCount)

  }

  function checkWarrantStatus() {
  var dirtyWarrant = document.getElementById('warrantMessage');
  var cleanWarrant = document.getElementById('noWarrantFound');
  var myValue = $('#civName').val();
  var civName = myValue.split(' ')
  var myVar = <%- JSON.stringify(civilians) %>;
  var index = 0;
  for (i=0; i < myVar.length; i++) {
    if ((myVar[i].civilian.firstName === civName[0]) && (myVar[i].civilian.lastName === civName[1])) {
      index = i;
      break;
    }
  }

  var warrants = myVar[index].civilian.warrants
  if (warrants === "1") {
    cleanWarrant.style.display = 'block';
    dirtyWarrant.style.display = 'none';
  } else {
    dirtyWarrant.style.display = 'block';
    cleanWarrant.style.display = 'none';

  }
}

$(document).on("keypress", "form", function(event) {
    return event.keyCode != 13;
});

$('#plateName').on("keyup", function(e) {
    if (e.keyCode == 13) {
        searchPlate()
    }
});

$('#civName').on("keyup", function(e) {
    if (e.keyCode == 13) {
        searchNames()
    }
});

function toggle_visibility(id) {
      if(id.style.display == 'block')
         id.style.display = 'none';
      else
         id.style.display = 'block';
   }

function setDateAndTime() {
  date = document.getElementById('date');
  time = document.getElementById('time');



  date.value = new Date().toLocaleDateString();
  time.value = new Date().toLocaleTimeString('en-GB', { hour: "numeric", minute: "numeric"});
}


</script>
