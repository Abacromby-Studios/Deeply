<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Police Dashboard</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M" crossorigin="anonymous">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    <link rel="stylesheet" type="text/css" href="css/structure.css">

  </head>
  <body>
    <div class="row margin-top-4">
      <div class="col-md-12 text-align-center font-size-20-px margin-left-2">
        San Andreas <img class="image-star" src="/images/star.png" alt="star"> Police Operations
      </div>

    </div>

    <div class="row">
      <div class="col-md-12 text-align-center font-size-20-px">
        Hi, <%= user.user.username %>
      </div>
    </div>

    <div class="row margin-top-2">
      <div class="col-md-12 text-align-center">
        <button type="button" class="btn btn-primary btn-width-150" data-toggle="modal" data-target=".run-name">Name Database</button>
        <button type="button" class="btn btn-primary btn-width-150" data-toggle="modal" data-target=".run-plate">Plate Database</button>
        <button type="button" class="btn btn-default btn-width-150" onClick="parent.location='/logout'">Log Out</button>
      </div>
    </div>

    <div class="modal fade run-name" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg">

        <div id="warrantMessage" class="alert alert-danger" style="display:none">
          <strong>Danger!</strong> Warrant found for this suspect.
        </div>
        <div id="noWarrantFound" class="alert alert-success" style="display:none">
          <strong>Clean!</strong> No Warrants found.
        </div>
        <div class="modal-content">
          <form id="search-form" class="form-horizontal" action="" method="">
            <fieldset>

              <!-- Form Name -->
              <legend class="text-align-center">Person Database</legend>
              <datalist id="names">
                <% for(var i=0; i<civilians.length; i++) {%>
             <option value="<%= civilians[i].civilian.firstName %> <%= civilians[i].civilian.lastName%>">
            <% } %>
              </datalist>
              <!-- Text input-->
              <div class="form-group">
                <label class="col-md-4 control-label" for="civName">Civilian Name</label>
                <div class="col-md-4">
                  <input id="civName" name="civName" type="text" placeholder="Civilian Name" class="form-control input-md" list="names" required>
                </div>
                <div class="col-md-4">
                  <button type="button" name="searchCiv" class="btn btn-info" onclick="searchNames()" >Search</button>
                </div>
              </div>


               <div id="civDetails" class="civ-details" style="display:none">
                <div id="first-and-last-name" class="col-md-12 name">
                  FirstName LastName
                </div>
                <div class="col-md-12">
                  <div class="col-md-1 font-size-16-px">
                    DOB:
                  </div>
                  <div id="birthday" class="col-md-1 birthday font-size-16-px">
                    mm/dd/yyyy
                  </div>
                </div>
                <div id="address" class="col-md-12 address font-size-16-px">
                  Address: - - -
                </div>
                <div class="col-md-12 ncic-button">
                  <button id="warrants" type="button" class="btn btn-primary btn-width-150" onclick="checkWarrantStatus()">NCIC Warrant Check</button>
                </div>
                <div class="col-md-12">
                  <div class="col-md-2 col-md-offset-4 font-size-16-px">
                    License:
                  </div>
                   <div id="license-status" class="col-md-1 font-size-16-px license-status">
                      license status
                  </div>
                </div>


                <div class="col-md-12">
                  <div  class="col-md-3 col-md-offset-4 font-size-16-px">
                    Ticket Count:
                  </div>
                   <div id="ticket-count" class="col-md-1 font-size-16-px ticket-count">
                     # tickets
                   </div>
                </div>
               </div>
            </fieldset>
          </form>
        </div>
      </div>
    </div>

    <div class="modal fade run-plate" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">

        </div>
      </div>
    </div>

  </body>
</html>

<script type="text/javascript">

  function searchNames(){
    var cleanWarrant = document.getElementById('noWarrantFound');
    var dirtyWarrant = document.getElementById('warrantMessage');
    cleanWarrant.style.display = 'none';
    dirtyWarrant.style.display = 'none';
    var x = document.getElementById('civDetails');
    if (x.style.display === 'none') {
        x.style.display = 'block';
    } else {
    }
    var myValue = $('#civName').val();
    var civName = myValue.split(' ')
    var myVar = <%- JSON.stringify(civilians) %>;
    var index = 0;
    for (i=0; i < myVar.length; i++) {
      if ((myVar[i].civilian.firstName === civName[0]) && (myVar[i].civilian.lastName === civName[1])) {
        index = i;
        break;
      }
    }
    var name = myVar[index].civilian.firstName + ' ' + myVar[index].civilian.lastName
    var birthday = myVar[index].civilian.birthday
    var address = myVar[index].civilian.address
    var licenseStatus = myVar[index].civilian.licenseStatus
    switch(licenseStatus) {
      case "1":
        licenseStatus = "Valid"
        break
      case "2":
        licenseStatus = "Revoked"
        break
      default:
        licenseStatus = "None"
    }

    var warrants = myVar[index].civilian.warrants
    if (warrants === "1") {
      warrants = "No"
    } else {
      warrants = "Yes"
    }

    var ticketCount = myVar[index].civilian.ticketCount
    $('#first-and-last-name').text(name)
    $('#birthday').text(birthday)
    $('#address').text(address)
    $('#license-status').text(licenseStatus)

    $('#ticket-count').text(ticketCount)

  }

function checkWarrantStatus() {
  var dirtyWarrant = document.getElementById('warrantMessage');
  var cleanWarrant = document.getElementById('noWarrantFound');
  var myValue = $('#civName').val();
  var civName = myValue.split(' ')
  var myVar = <%- JSON.stringify(civilians) %>;
  var index = 0;
  for (i=0; i < myVar.length; i++) {
    if ((myVar[i].civilian.firstName === civName[0]) && (myVar[i].civilian.lastName === civName[1])) {
      index = i;
      break;
    }
  }

  var warrants = myVar[index].civilian.warrants
  if (warrants === "1") {
    cleanWarrant.style.display = 'block';
    dirtyWarrant.style.display = 'none';
  } else {
    dirtyWarrant.style.display = 'block';
    cleanWarrant.style.display = 'none';

  }
}


</script>
